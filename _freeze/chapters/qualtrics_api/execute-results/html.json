{
  "hash": "b537fda938c2ecea50c3ec76b355f944",
  "result": {
    "markdown": "---\ntitle: \"Qualtrics API\"\neditor: visual\nmessage: false\nwarning: false\n---\n\n\nInstead of downloading your data through Qualtrics every time we will load data using Qualtrics API. For a complete guide refer to this [vignette](https://cran.r-project.org/web/packages/qualtRics/vignettes/qualtRics.html), which this guide is based on.\n\nUniversity of San Francisco provides access to Qualtrics; however you need to separately request API access. Good news, I have talked to ITS and you should already have it! If not let me know!\n\nFirst, we need to install a package `qualtRics`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"qualtRics\")\nlibrary(\"tidyverse\")\nlibrary(\"qualtRics\")\nlibrary(\"scales\")\nknitr::opts_chunk$set(echo = T, warning = F, message = F, error = F)\n```\n:::\n\n\n## Core Functions\n\nCurrently, the package contains three core functions:\n\n-   `all_surveys()` shows surveys you can access.\n-   `fetch_survey()` downloads the survey.\n-   `read_survey()` reads CSV files you downloaded manually from Qualtrics.\n\nIt also contains a number of helper functions, including:\n\n-   `qualtrics_api_credentials()` stores your API key and base url in environment variables.\n-   `survey_questions()` retrieves a data frame containing questions and question IDs for a survey;\n-   `extract_colmap()` retrieves a similar data frame with more detailed mapping from columns to labels.\n-   `metadata()` retrieves metadata about your survey, such as questions, survey flow, number of responses etc.\n\nNote that you can only export surveys that you own, or to which you have been given administration rights.\n\n## Connecting to the API\n\nIf you have received API access, now you can connect to the API. To get `api_key` and `base_url` go to Qualtrics Home Page \\> Account Settings \\> Qualtrics IDs or click [this link](https://usfca.qualtrics.com/Q/QualtricsIdsSection/IdsSection). Under \"API\" click \"Generate Topic\" and you will be issued a Token. Copy this string a put in \"YOUR_API_KEY\". Then look at \"User\" module, copy \"Datacenter ID\" and \".qualtrics.com\" after it. Your Base Url should look something like this: \"lad2.qualtrics.com\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqualtrics_api_credentials(\n  api_key = \"YOUR_API_KEY\",\n  base_url = \"YOUR_BASE_URL\",\n  install = TRUE,\n  # overwrite = TRUE # If you need to update your credentials\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nqualtrics_api_credentials(\n  api_key = \"CEOj8Iwh6BUTNZ9J7PXDJLZpStQaXkmlwLPYzCgu\",\n  base_url = \"lad2.qualtrics.com\",\n  install = TRUE\n)\n```\n:::\n\n\nAfter `qualtrics_api_credintials` stored your credentials, you can use `all_surveys()` to fetch information on your surveys.\n\n\n::: {.cell hash='qualtrics_api_cache/html/unnamed-chunk-4_0aac0bda945d49a560b4f230c95ae80a'}\n\n```{.r .cell-code}\n(surveys <- all_surveys()) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 6\n  id                 name                        ownerId lastM…¹ creat…² isAct…³\n  <chr>              <chr>                       <chr>   <chr>   <chr>   <lgl>  \n1 SV_0rearXjH2Ri6umq Student Satisfaction        UR_2tz… 2023-0… 2023-0… FALSE  \n2 SV_2gWVWLn2vCCDJGu Luvuyo                      UR_2tz… 2022-0… 2022-0… FALSE  \n3 SV_3h0HPHQbJStqb8a Pilot (USA) - Giver Motive… UR_2tz… 2022-0… 2022-0… FALSE  \n4 SV_3Q011O6gNqwn1Nc Pen Experiment              UR_2tz… 2022-1… 2022-1… FALSE  \n5 SV_4YDoTFLN61nKecS Pen_Showcase                UR_2tz… 2023-0… 2023-0… TRUE   \n6 SV_4Yhvzriag8syz7U Prosociality Experiment     UR_2tz… 2023-0… 2022-0… FALSE  \n7 SV_bJIs8lwz4CfAAgS test                        UR_2tz… 2023-0… 2023-0… TRUE   \n8 SV_dnBQ3YB4rLC03J4 test2                       UR_2tz… 2023-0… 2023-0… FALSE  \n# … with abbreviated variable names ¹​lastModified, ²​creationDate, ³​isActive\n```\n:::\n:::\n\n\nOnce you select the questionnaire you want you can refer to it using `id`. If you want redownload the data set `force_request = TRUE`, otherwise it will load prior saved download.\n\n\n::: {.cell}\n<style type=\"text/css\">\n.output {\nmax-height: 300px;\noverflow-y: scroll;\n}\n</style>\n:::\n\n::: {.cell class='output' hash='qualtrics_api_cache/html/unnamed-chunk-6_e835300b3fd6a7e8430612d48e855b3c'}\n\n```{.r .cell-code}\nsurvey_data <- fetch_survey(\n  surveyID = \"SV_bJIs8lwz4CfAAgS\",\n  verbose = FALSE,\n  force_request = TRUE\n)\nsurvey_data %>% glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 22\nColumns: 89\n$ StartDate                 <dttm> 2023-02-07 16:00:52, 2023-02-07 16:01:17, 2…\n$ EndDate                   <dttm> 2023-02-07 16:04:08, 2023-02-07 16:04:08, 2…\n$ Status                    <chr> \"IP Address\", \"IP Address\", \"IP Address\", \"I…\n$ IPAddress                 <chr> \"138.202.129.171\", \"138.202.129.164\", \"138.2…\n$ Progress                  <dbl> 100, 100, 100, 100, 100, 100, 100, 100, 100,…\n$ `Duration (in seconds)`   <dbl> 196, 171, 104, 187, 189, 198, 210, 209, 180,…\n$ Finished                  <lgl> TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…\n$ RecordedDate              <dttm> 2023-02-07 16:04:09, 2023-02-07 16:04:09, 2…\n$ ResponseId                <chr> \"R_3r385toH6wjBmyr\", \"R_2usVBjQ7yXrmY72\", \"R…\n$ RecipientLastName         <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ RecipientFirstName        <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ RecipientEmail            <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ ExternalReference         <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ LocationLatitude          <dbl> 37.78, 37.78, 37.78, 37.78, 37.78, 37.78, 37…\n$ LocationLongitude         <dbl> -122.465, -122.465, -122.465, -122.465, -122…\n$ DistributionChannel       <chr> \"anonymous\", \"anonymous\", \"anonymous\", \"anon…\n$ UserLanguage              <chr> \"EN\", \"EN\", \"EN\", \"EN\", \"EN\", \"EN\", \"EN\", \"E…\n$ Consent                   <ord> Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes,…\n$ Gender                    <ord> Female, Female, Male, Male, Male, Male, Male…\n$ Name                      <chr> \"Tasha\", \"Khushboo Patel\", \"Nikita\", \"Lawren…\n$ Competitive               <ord> Competitive, Competitive, Competitive, Compe…\n$ Pizzas_1                  <chr> \"Margherita\", NA, NA, \"Margherita\", \"Margher…\n$ Pizzas_2                  <chr> \"Pepperoni\", NA, NA, \"Pepperoni\", \"Pepperoni…\n$ Pizzas_3                  <chr> NA, \"BBQ Chicken\", NA, NA, \"BBQ Chicken\", \"B…\n$ Pizzas_4                  <chr> \"Hawaiian\", NA, NA, NA, \"Hawaiian\", NA, \"Haw…\n$ Pizzas_5                  <chr> \"Veggie\", \"Veggie\", \"Veggie\", \"Veggie\", \"Veg…\n$ Pizzas_6                  <chr> NA, NA, NA, NA, NA, \"I also love that one:\",…\n$ Pizzas_7                  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ Pizzas_6_TEXT             <chr> NA, NA, NA, NA, NA, \"Garlic White Chinese be…\n$ Pizzas_DO_1               <dbl> 5, 1, 2, 4, 5, 3, 1, 1, 5, 5, 3, 1, 5, 1, 4,…\n$ Pizzas_DO_2               <dbl> 3, 3, 5, 1, 3, 2, 3, 3, 1, 4, 2, 5, 3, 3, 5,…\n$ Pizzas_DO_3               <dbl> 2, 2, 3, 5, 4, 1, 4, 5, 2, 2, 1, 3, 1, 2, 2,…\n$ Pizzas_DO_4               <dbl> 1, 4, 1, 3, 2, 5, 2, 2, 3, 1, 5, 4, 2, 5, 1,…\n$ Pizzas_DO_5               <dbl> 4, 5, 4, 2, 1, 4, 5, 4, 4, 3, 4, 2, 4, 4, 3,…\n$ Pizzas_DO_6               <dbl> 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,…\n$ Pizzas_DO_7               <dbl> 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,…\n$ `1_Taste`                 <dbl> 5, NA, NA, 5, 3, NA, 3, 4, 4, 5, 4, NA, NA, …\n$ `1_Healthiness`           <dbl> 5, NA, NA, 4, 4, NA, 2, 3, 3, 5, 2, NA, NA, …\n$ `1_Ease_Of_Preparation`   <dbl> 5, NA, NA, 4, 4, NA, 4, 3, 4, 3, 3, NA, NA, …\n$ `2_Taste`                 <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `2_Healthiness`           <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `2_Ease_Of_Preparation`   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `3_Taste`                 <dbl> NA, NA, NA, NA, NA, 4, 5, NA, 4, NA, NA, NA,…\n$ `3_Healthiness`           <dbl> NA, NA, NA, NA, NA, 3, 3, NA, 2, NA, NA, NA,…\n$ `3_Ease_Of_Preparation`   <dbl> NA, NA, NA, NA, NA, 3, 4, NA, 3, NA, NA, NA,…\n$ `9_Taste`                 <dbl> 5, NA, NA, 5, 5, NA, 5, NA, NA, NA, 5, NA, 4…\n$ `9_Healthiness`           <dbl> 3, NA, NA, 3, 2, NA, 2, NA, NA, NA, 2, NA, 4…\n$ `9_Ease_Of_Preparation`   <dbl> 5, NA, NA, 5, 4, NA, 4, NA, NA, NA, 4, NA, N…\n$ `10_Taste`                <dbl> NA, 5, NA, NA, 5, 5, 3, 4, 4, NA, 4, NA, 4, …\n$ `10_Healthiness`          <dbl> NA, NA, NA, NA, 2, 3, 2, 3, 3, NA, 2, NA, 4,…\n$ `10_Ease_Of_Preparation`  <dbl> NA, NA, NA, NA, 3, 3, 2, 3, 2, NA, 3, NA, NA…\n$ `11_Taste`                <dbl> 5, NA, NA, NA, 4, NA, 5, 4, NA, NA, 4, 5, NA…\n$ `11_Healthiness`          <dbl> 4, NA, NA, NA, 2, NA, 2, 3, NA, NA, 3, 4, NA…\n$ `11_Ease_Of_Preparation`  <dbl> 5, NA, NA, NA, 3, NA, 3, 2, NA, NA, 2, 3, NA…\n$ `12_Taste`                <dbl> 5, 4, 4, 4, 4, NA, 3, NA, NA, NA, 4, NA, NA,…\n$ `12_Healthiness`          <dbl> 5, 2, 5, 5, 4, NA, 3, NA, NA, NA, 4, NA, NA,…\n$ `12_Ease_Of_Preparation`  <dbl> 4, 3, 3, 3, 2, NA, 2, NA, NA, NA, 3, NA, NA,…\n$ `match timer_First Click` <dbl> 0.000, 0.000, 0.000, 0.000, 20.317, 0.000, 0…\n$ `match timer_Last Click`  <dbl> 0.000, 0.000, 0.000, 0.000, 20.317, 0.000, 0…\n$ `match timer_Page Submit` <dbl> 8.296, 12.572, 7.955, 22.206, 21.188, 7.224,…\n$ `match timer_Click Count` <dbl> 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…\n$ transfer                  <dbl> 50, NA, 35, NA, 49, NA, NA, 35, NA, 10, 50, …\n$ `get timer_First Click`   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ `get timer_Last Click`    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ `get timer_Page Submit`   <dbl> 4.999, 15.967, 32.000, 2.787, 3.006, 10.538,…\n$ `get timer_Click Count`   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ decision...67             <chr> NA, \"I accept A's offer.\\n(You get ${e://Fie…\n$ Q23                       <ord> Yes, Absolutely, Absolutely, Yes, Yes, Yes, …\n$ researcherID              <chr> \"hTtZNw8TA0\", \"hTtZNw8TA0\", \"hTtZNw8TA0\", \"h…\n$ studyID                   <chr> \"test\", \"test\", \"test\", \"test\", \"test\", \"tes…\n$ groupID                   <dbl> 6, 6, 5, 5, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11…\n$ participantID             <chr> \"R_3r385toH6wjBmyr\", \"R_2usVBjQ7yXrmY72\", \"R…\n$ groupSize                 <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…\n$ numStages                 <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…\n$ roles                     <chr> \"A,B\", \"A,B\", \"A,B\", \"A,B\", \"A,B\", \"A,B\", \"A…\n$ participantRole           <chr> \"A\", \"B\", \"A\", \"B\", \"A\", \"B\", \"B\", \"A\", \"B\",…\n$ timeOutLog                <chr> \"OK -- no issues\", \"OK -- no issues\", \"OK --…\n$ botMatch                  <chr> \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"n…\n$ total                     <dbl> 100, 100, 100, 100, 100, 100, 100, 100, 100,…\n$ offer                     <dbl> 50, 50, 35, 35, 49, 49, 35, 35, 10, 10, 50, …\n$ decision...81             <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ payoff                    <dbl> 50, 50, 65, 35, 51, 49, 35, 65, 10, 90, 50, …\n$ sendStage                 <dbl> 1, 2, 1, 2, 1, 2, 2, 1, 2, 1, 1, 2, 1, 2, 2,…\n$ sendData                  <chr> \"offer\", \"decision\", \"offer\", \"decision\", \"o…\n$ getStage                  <dbl> 2, 1, 2, 1, 2, 1, 1, 2, 1, 2, 2, 1, 2, 1, 1,…\n$ getData                   <chr> \"B\", \"A\", \"B\", \"A\", \"B\", \"A\", \"A\", \"B\", \"A\",…\n$ defaultData               <dbl> 2, 20, 2, 5, 2, 71, 61, 1, 83, 2, 2, 81, 1, …\n$ saveData                  <chr> \"decision\", \"offer\", \"decision\", \"offer\", \"d…\n$ randomPercent             <dbl> NA, 20, NA, 5, NA, 71, 61, NA, 83, NA, NA, 8…\n```\n:::\n:::\n\n\nIn case you want to see text of the questions use `survey_questions()`.\n\n\n::: {.cell hash='qualtrics_api_cache/html/unnamed-chunk-7_6ad0d0b5996866016fde99428cef607e'}\n\n```{.r .cell-code}\nsurvey_questions <- survey_questions(surveyID = \"SV_bJIs8lwz4CfAAgS\")\nhead(survey_questions, n = 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 4\n  qid   qname        question                                         force_resp\n  <chr> <chr>        <chr>                                            <lgl>     \n1 QID25 Introduction \"Welcome to the <strong>University of San Franc… FALSE     \n2 QID26 Consent      \"Do you agree to participate in the survey?\"     TRUE      \n3 QID21 Gender       \"What is your gender\"                            TRUE      \n4 QID23 Name         \"What is your Name?\"                             FALSE     \n5 QID22 Competitive  \"Would you consider yourself competitive?\"       FALSE     \n```\n:::\n:::\n\n\n## Example\n\n\n::: {.cell hash='qualtrics_api_cache/html/unnamed-chunk-8_f8fa5de8f0fb821533c931d6639eb4fc'}\n\n```{.r .cell-code}\nsurvey_data <- fetch_survey(\n  surveyID = \"SV_bJIs8lwz4CfAAgS\",\n  verbose = FALSE, force_request = TRUE\n)\n\nsurvey_data <- survey_data %>% janitor::clean_names()\n\ngraph_data <- survey_data %>%\n  select(gender, offer, decision_81, participant_id, participant_role) %>%\n  mutate(\n    participant_role = recode(participant_role, \"A\" = \"dictator\", \"B\" = \"recipient\"),\n    decision = recode(decision_81, \"1\" = \"Accepted\", \"2\" = \"Declined\")\n  ) %>%\n  mutate(interval = cut_width(offer, width = 10, center = 45)) %>%\n  filter(participant_role == \"recipient\") %>%\n  count(decision, interval)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ngraph_data %>%\n  ggplot(aes(x = interval, y = n, fill = as.factor(decision))) +\n  geom_col(position = position_stack()) +\n  theme_minimal(base_size = 20) +\n  scale_y_continuous(breaks = scales::breaks_extended(n = max(graph_data$n))) +\n  theme(\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    legend.position = \"top\"\n  ) +\n  labs(x = \"Offer size\", y = \"Count\", title = \"Results of the Ultimatum Game\", fill = \"Result\")\n```\n\n::: {.cell-output-display}\n![](qualtrics_api_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}